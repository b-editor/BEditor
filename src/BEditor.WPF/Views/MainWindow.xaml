<Controls:MetroWindow
    x:Class="BEditor.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    xmlns:command="clr-namespace:BEditor.Command;assembly=BEditor.Core"
    xmlns:convert="clr-namespace:BEditor.ViewModels.Converters"
    xmlns:custom="clr-namespace:BEditor.WPF.Controls;assembly=BEditor.WPF.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:model="clr-namespace:BEditor.Models"
    xmlns:objdata="clr-namespace:BEditor.Data;assembly=BEditor.Core"
    xmlns:properties="clr-namespace:BEditor.Properties;assembly=BEditor.Core"
    xmlns:tool="clr-namespace:BEditor.Views.ToolControl"
    xmlns:vm="clr-namespace:BEditor.ViewModels"
    x:Name="window"
    Width="1440"
    Height="760"
    MinWidth="1000"
    MinHeight="500"
    d:DesignHeight="1080"
    d:DesignWidth="1920"
    Closing="MetroWindow_Closing"
    DataContext="{x:Static vm:MainWindowViewModel.Current}"
    Focusable="True"
    Style="{StaticResource DefaultWindowStyle}"
    mc:Ignorable="d">
    <Controls:MetroWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignColors;component/Themes/MaterialDesignColor.Lime.Accent.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <convert:PathToImageSource x:Key="PathToImageSource" />
            <SolidColorBrush x:Key="SecondaryHueDarkBrush" Color="{StaticResource Accent200}" />

            <convert:AppStatusIconConverter x:Key="AppStatusIcon" />
            <convert:AppStatusTextConverter x:Key="AppStatusText" />
            <convert:AppStatusToPlayerIconConverter x:Key="AppStatusToPlayerIcon" />
            <convert:SceneToPropertyTab x:Key="SceneToPropertyTab" />
            <convert:SceneToTimeLine x:Key="SceneToTimeLine" />
            <convert:FrameConverter x:Key="FrameConverter" />
            <convert:ToFileNameConverter x:Key="ToFileNameConverter" />


            <Style
                x:Key="OpenContextButtonStyle"
                BasedOn="{StaticResource WindowTitleButtonStyle}"
                TargetType="{x:Type Button}">
                <EventSetter Event="Click" Handler="Button_Click" />
            </Style>
            <Style
                x:Key="TitleButtonStyle"
                BasedOn="{StaticResource OpenContextButtonStyle}"
                TargetType="{x:Type Button}">
                <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}" />
            </Style>
            <Style
                x:Key="StatusBarOpenContextButton"
                BasedOn="{StaticResource StatusBarButton}"
                TargetType="{x:Type Button}">
                <EventSetter Event="Click" Handler="Button_Click" />
            </Style>
            <Style x:Key="MouseOverIcon" TargetType="md:PackIcon">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Width" Value="20" />
                <Setter Property="Height" Value="20" />
                <Setter Property="Margin" Value="5,0,5,0" />
                <Setter Property="VerticalAlignment" Value="Center" />
                <EventSetter Event="MouseDown" Handler="ObjectMouseDown" />
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#25FFFFFF" />
                    </Trigger>
                </Style.Triggers>
            </Style>
            <Style x:Key="LoadedObject" TargetType="TextBlock">
                <Setter Property="Padding" Value="8" />
                <EventSetter Event="MouseDown" Handler="LoadedObjectMouseDown" />
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#25FFFFFF" />
                    </Trigger>
                </Style.Triggers>
            </Style>
        </ResourceDictionary>
    </Controls:MetroWindow.Resources>
    <Controls:MetroWindow.InputBindings>
        <KeyBinding Command="{Binding EditModel.ClipboardPaste, Mode=OneTime}" Gesture="Ctrl+v" />
        <KeyBinding Command="{Binding EditModel.ClipboardCopy, Mode=OneTime}" Gesture="Ctrl+c" />
        <KeyBinding Command="{Binding EditModel.ClipboardCut, Mode=OneTime}" Gesture="Ctrl+x" />
        <KeyBinding Command="{Binding ProjectModel.Save, Mode=OneTime}" Gesture="Ctrl+s" />
        <KeyBinding Command="{Binding EditModel.Undo, Mode=OneTime}" Gesture="Ctrl+z" />
        <KeyBinding Command="{Binding EditModel.Redo, Mode=OneTime}" Gesture="Ctrl+y" />
        <KeyBinding Command="{Binding ProjectModel.Open, Mode=OneTime}" Gesture="Ctrl+o" />
        <KeyBinding Command="{Binding MoveFrame, Mode=OneTime}" Gesture="Ctrl+g" />
        <KeyBinding Key="Delete" Command="{Binding EditModel.ClipRemove, Mode=OneWay}" />
        <KeyBinding Key="Right" Command="{Binding FrameNext, Mode=OneWay}" />
        <KeyBinding Key="Left" Command="{Binding FramePrevious, Mode=OneWay}" />
        <KeyBinding Key="Space" Command="{Binding PlayPause, Mode=OneWay}" />
    </Controls:MetroWindow.InputBindings>

    <!--#region メニュー-->
    <Controls:MetroWindow.LeftWindowCommands>
        <Controls:WindowCommands>
            <VirtualizingStackPanel Orientation="Horizontal">
                <md:PackIcon
                    Width="18"
                    Height="18"
                    Margin="10,0,10,0"
                    VerticalAlignment="Center"
                    Foreground="{StaticResource PrimaryHueMidBrush}"
                    Kind="Movie" />
                <Button Content="{x:Static properties:Resources.AccessFile}" Style="{StaticResource TitleButtonStyle}">
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem
                                Height="30"
                                Command="{Binding ProjectModel.Open, Mode=OneTime}"
                                Header="{x:Static properties:Resources.AccessOpen}" />
                            <MenuItem Header="{x:Static properties:Resources.AccessCreate_new}">
                                <MenuItem Command="{Binding ProjectModel.Create, Mode=OneTime}" Header="{x:Static properties:Resources.Create_project}" />
                                <MenuItem Header="{x:Static properties:Resources.From_backup}" />
                            </MenuItem>
                            <Separator Height="10" />
                            <MenuItem
                                Command="{Binding ProjectModel.Save, Mode=OneTime}"
                                Header="{x:Static properties:Resources.AccessSave}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <MenuItem
                                Command="{Binding ProjectModel.SaveAs, Mode=OneTime}"
                                Header="{x:Static properties:Resources.Save_as}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <MenuItem
                                Command="{Binding ProjectModel.Close, Mode=OneTime}"
                                Header="{x:Static properties:Resources.Close}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <Separator Height="10" />
                            <MenuItem x:Name="UsedFiles" Header="{x:Static properties:Resources.MostRecentlyUsedList}" />
                            <Separator Height="10" />
                            <MenuItem Command="{Binding Shutdown, Mode=OneTime}" Header="{x:Static properties:Resources.Shutdown}" />
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
                <Button Content="{x:Static properties:Resources.AccessEdit}" Style="{StaticResource TitleButtonStyle}">
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem
                                Command="{Binding EditModel.Undo, Mode=OneTime}"
                                Header="{x:Static properties:Resources.Undo}"
                                IsEnabled="{Binding Source={x:Static command:CommandManager.Default}, Path=CanUndo, Mode=OneWay}" />
                            <MenuItem
                                Command="{Binding EditModel.Redo, Mode=OneTime}"
                                Header="{x:Static properties:Resources.Redo}"
                                IsEnabled="{Binding Source={x:Static command:CommandManager.Default}, Path=CanRedo, Mode=OneWay}" />
                            <MenuItem
                                Command="{Binding EditModel.ClipRemove, Mode=OneTime}"
                                Header="{x:Static properties:Resources.Remove}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <Separator Height="10" />
                            <MenuItem
                                Command="{Binding EditModel.ClipboardCut, Mode=OneTime}"
                                Header="{x:Static properties:Resources.Cut}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <MenuItem
                                Command="{Binding EditModel.ClipboardCopy, Mode=OneTime}"
                                Header="{x:Static properties:Resources.Copy}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <MenuItem
                                Command="{Binding EditModel.ClipboardPaste, Mode=OneTime}"
                                Header="{x:Static properties:Resources.Paste}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <Separator Height="10" />
                            <MenuItem
                                Command="{Binding PlayPause, Mode=OneTime}"
                                Header="{x:Static properties:Resources.PlayPause}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <MenuItem
                                Command="{Binding FrameTop, Mode=OneTime}"
                                Header="{x:Static properties:Resources.MoveToTop}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <MenuItem
                                Command="{Binding FrameEnd, Mode=OneTime}"
                                Header="{x:Static properties:Resources.MoveToEnd}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}" />
                            <MenuItem
                                Command="{Binding FramePrevious, Mode=OneTime}"
                                Header="{x:Static properties:Resources.MoveToPreviousFrame}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                                ToolTip="{x:Static properties:Resources.MoveToPreviousFrame}" />
                            <MenuItem
                                Command="{Binding FrameNext, Mode=OneTime}"
                                Header="{x:Static properties:Resources.MoveToNextFrame}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                                ToolTip="{x:Static properties:Resources.MoveToNextFrame}" />
                            <MenuItem
                                Command="{Binding MoveFrame, Mode=OneTime}"
                                Header="{x:Static properties:Resources.Move_to_the_specified_frame}"
                                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                                ToolTip="{x:Static properties:Resources.Move_to_the_specified_frame}" />
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
                <Button Content="{x:Static properties:Resources.AccessView}" Style="{StaticResource TitleButtonStyle}">
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Click="TimelineShowHide" Header="{x:Static properties:Resources.TimelineShowHide}" />
                            <MenuItem Click="PropertyShowHide" Header="{x:Static properties:Resources.PropertyShowHide}" />
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
                <Button
                    Content="{x:Static properties:Resources.AccessProject}"
                    Style="{StaticResource TitleButtonStyle}"
                    Visibility="{Binding ProjectIsOpened.Value, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Command="{Binding EditModel.SceneAdd, Mode=OneTime}" Header="{x:Static properties:Resources.AddScene}" />
                            <MenuItem Command="{Binding EditModel.ClipAdd, Mode=OneTime}" Header="{x:Static properties:Resources.AddClip}" />
                            <MenuItem Command="{Binding EditModel.EffectAdd, Mode=OneTime}" Header="{x:Static properties:Resources.AddEffect}" />
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
                <Button Content="{x:Static properties:Resources.AccessTool}" Style="{StaticResource TitleButtonStyle}">
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Command="{Binding SettingShow, Mode=OneTime}" Header="{x:Static properties:Resources.Settings}" />
                            <MenuItem Header="{x:Static properties:Resources.Optimization}">
                                <MenuItem Command="{Binding MemoryRelease, Mode=OneTime}" Header="{x:Static properties:Resources.MemoryRelease}" />
                                <MenuItem Command="{Binding DeleteCommand, Mode=OneTime}" Header="{x:Static properties:Resources.DeleteCommand}" />
                            </MenuItem>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
                <Button Content="{x:Static properties:Resources.AccessPlugin}" Style="{StaticResource TitleButtonStyle}">
                    <Button.ContextMenu>
                        <ContextMenu x:Name="PluginMenu" />
                    </Button.ContextMenu>
                </Button>
                <Button Content="{x:Static properties:Resources.AccessOut}" Style="{StaticResource TitleButtonStyle}">
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem
                                Height="30"
                                Command="{Binding Output.VideoCommand, Mode=OneTime}"
                                Header="{x:Static properties:Resources.VideoOutput}" />
                            <MenuItem Command="{Binding Output.ImageCommand, Mode=OneTime}" Header="{x:Static properties:Resources.ImageOutput}" />
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
                <Button Content="{x:Static properties:Resources.AccessHelp}" Style="{StaticResource TitleButtonStyle}">
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem
                                Height="30"
                                Command="{Binding SendFeedback, Mode=OneTime}"
                                Header="{x:Static properties:Resources.SendFeedback}" />
                            <MenuItem
                                Height="30"
                                Command="{Binding OpenThisRepository, Mode=OneTime}"
                                Header="{x:Static properties:Resources.OpenThisRepository}" />
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
            </VirtualizingStackPanel>
        </Controls:WindowCommands>
    </Controls:MetroWindow.LeftWindowCommands>
    <!--#endregion-->

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="10" />
            <RowDefinition x:Name="TimelineGrid" Height="*" />
            <RowDefinition Height="24" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="PropertyGrid" Width="425" />
            <ColumnDefinition Width="10" />
            <ColumnDefinition Width="1*" />
            <ColumnDefinition Width="10" />
            <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>

        <!--#region ToolBar-->
        <Grid
            Grid.ColumnSpan="5"
            Background="{DynamicResource MaterialDesignToolBarBackground}"
            IsHitTestVisible="{Binding Source={x:Static model:AppData.Current}, Path=IsNotPlaying, Mode=OneWay}">
            <ToolBarTray>
                <ToolBar>
                    <Button
                        Margin="5,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding ProjectModel.Create, Mode=OneTime}"
                        ToolTip="{x:Static properties:Resources.Create_new}">
                        <md:PackIcon
                            Width="20"
                            Height="20"
                            Kind="FilePlus" />
                    </Button>
                    <Button
                        Margin="5,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding ProjectModel.Open, Mode=OneTime}"
                        ToolTip="{x:Static properties:Resources.Open}">
                        <md:PackIcon
                            Width="20"
                            Height="20"
                            Kind="FolderOpen" />
                    </Button>
                    <Button
                        Margin="10,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding ProjectModel.Save, Mode=OneTime}"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        ToolTip="{x:Static properties:Resources.Save}">
                        <md:PackIcon
                            Width="20"
                            Height="20"
                            Kind="ContentSave" />
                    </Button>
                    <Separator Margin="6,3,6,3" VerticalAlignment="Stretch" />
                    <Button
                        Margin="5,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding EditModel.Undo, Mode=OneTime}"
                        IsEnabled="{Binding Source={x:Static command:CommandManager.Default}, Path=CanUndo, Mode=OneWay}"
                        ToolTip="{x:Static properties:Resources.Undo}">
                        <md:PackIcon
                            Width="18"
                            Height="18"
                            Kind="Undo" />
                    </Button>
                    <Button
                        Margin="0,0,5,0"
                        Padding="0,0,0,0"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}">
                        <md:PopupBox>
                            <md:PopupBox.ToggleContent>
                                <md:PackIcon
                                    Width="18"
                                    Height="18"
                                    Foreground="{DynamicResource MaterialDesignBody}"
                                    Kind="ChevronDown" />
                            </md:PopupBox.ToggleContent>

                            <ScrollViewer Width="250" Height="300">
                                <ItemsControl ItemsSource="{Binding EditModel.UnDoList, Mode=OneWay}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Margin="8" Text="{Binding}" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                            </ScrollViewer>
                        </md:PopupBox>
                    </Button>
                    <Button
                        Margin="5,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding EditModel.Redo, Mode=OneTime}"
                        IsEnabled="{Binding Source={x:Static command:CommandManager.Default}, Path=CanRedo, Mode=OneWay}"
                        ToolTip="{x:Static properties:Resources.Redo}">
                        <md:PackIcon
                            Width="18"
                            Height="18"
                            Kind="Redo" />
                    </Button>
                    <Button
                        Margin="0,0,0,0"
                        Padding="0,0,0,0"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}">
                        <md:PopupBox>
                            <md:PopupBox.ToggleContent>
                                <md:PackIcon
                                    Width="18"
                                    Height="18"
                                    Foreground="{DynamicResource MaterialDesignBody}"
                                    Kind="ChevronDown" />
                            </md:PopupBox.ToggleContent>

                            <ScrollViewer Width="250" Height="300">
                                <ItemsControl ItemsSource="{Binding EditModel.ReDoList, Mode=OneWay}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Margin="8" Text="{Binding}" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </md:PopupBox>
                    </Button>
                    <Separator Margin="6,3,6,3" VerticalAlignment="Stretch" />
                    <Button
                        Margin="5,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding EditModel.ClipboardCut, Mode=OneTime}"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        ToolTip="{x:Static properties:Resources.Cut}">
                        <md:PackIcon
                            Width="20"
                            Height="20"
                            Kind="ContentCut" />
                    </Button>
                    <Button
                        Margin="5,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding EditModel.ClipboardCopy, Mode=OneTime}"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        ToolTip="{x:Static properties:Resources.Copy}">
                        <md:PackIcon
                            Width="20"
                            Height="20"
                            Kind="ContentCopy" />
                    </Button>
                    <Button
                        Margin="5,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding EditModel.ClipboardPaste, Mode=OneTime}"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        ToolTip="{x:Static properties:Resources.Paste}">
                        <md:PackIcon
                            Width="20"
                            Height="20"
                            Kind="ContentPaste" />
                    </Button>
                    <Separator Margin="6,3,6,3" VerticalAlignment="Stretch" />
                    <ComboBox
                        MinWidth="100"
                        Margin="5,0,5,0"
                        DisplayMemberPath="SceneName"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        ItemsSource="{Binding Project.SceneList, Mode=OneWay, Source={x:Static model:AppData.Current}}"
                        SelectedItem="{Binding Project.PreviewScene, Mode=TwoWay, Source={x:Static model:AppData.Current}}" />
                    <Button
                        Margin="5,0,0,0"
                        Padding="0,0,0,0"
                        Command="{Binding SceneSettingsCommand, Mode=OneTime}"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        ToolTip="{x:Static properties:Resources.SceneSettings}">
                        <md:PackIcon
                            Width="20"
                            Height="20"
                            Kind="TuneVariant" />
                    </Button>
                </ToolBar>
                <ToolBar
                    Height="27"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center">
                    <md:PackIcon
                        Foreground="{StaticResource VideoColor}"
                        Kind="Movie"
                        Style="{StaticResource MouseOverIcon}" />
                    <md:PackIcon
                        Foreground="{StaticResource ImageColor}"
                        Kind="Image"
                        Style="{StaticResource MouseOverIcon}" />
                    <md:PackIcon
                        Foreground="{StaticResource AudioColor}"
                        Kind="Audio"
                        Style="{StaticResource MouseOverIcon}" />
                    <md:PackIcon
                        Foreground="{StaticResource TextColor}"
                        Kind="TextBox"
                        Style="{StaticResource MouseOverIcon}" />
                    <md:PackIcon
                        Foreground="{StaticResource ImageColor}"
                        Kind="Shape"
                        Style="{StaticResource MouseOverIcon}" />
                    <md:PackIcon
                        Foreground="{StaticResource ImageColor}"
                        Kind="RoundedCorner"
                        Style="{StaticResource MouseOverIcon}" />
                    <md:PackIcon
                        Foreground="{StaticResource VideoColor}"
                        Kind="Videocam"
                        Style="{StaticResource MouseOverIcon}" />
                    <md:PackIcon
                        Foreground="{StaticResource VideoColor}"
                        Kind="Cube"
                        Style="{StaticResource MouseOverIcon}" />
                    <md:PackIcon
                        Foreground="{StaticResource VideoColor}"
                        Kind="MovieOpen"
                        Style="{StaticResource MouseOverIcon}" />
                    <Button
                        Margin="7,0,0,0"
                        Padding="0,0,0,0"
                        Cursor="Arrow">
                        <md:PopupBox>
                            <md:PopupBox.ToggleContent>
                                <md:PackIcon
                                    Width="18"
                                    Height="18"
                                    Foreground="{DynamicResource MaterialDesignBody}"
                                    Kind="ChevronDown" />
                            </md:PopupBox.ToggleContent>
                            <ScrollViewer Width="250" Height="300">
                                <ItemsControl ItemsSource="{x:Static objdata:ObjectMetadata.LoadedObjects}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Style="{StaticResource LoadedObject}" Text="{Binding Name}" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </md:PopupBox>
                    </Button>
                </ToolBar>
                <ToolBar
                    Height="27"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center">
                    <Button
                        Margin="5,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding Output.ImageCommand, Mode=OneTime}"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        ToolTip="{x:Static properties:Resources.ImageOutput}">
                        <md:PackIcon
                            Width="20"
                            Height="20"
                            Kind="AspectRatio" />
                    </Button>
                    <Button
                        Margin="5,0,5,0"
                        Padding="0,0,0,0"
                        Command="{Binding Output.VideoCommand, Mode=OneTime}"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        ToolTip="{x:Static properties:Resources.VideoOutput}">
                        <md:PackIcon
                            Width="20"
                            Height="20"
                            Kind="Filmstrip" />
                    </Button>
                </ToolBar>
            </ToolBarTray>
            <VirtualizingStackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                <Button
                    Padding="8,0"
                    Command="{Binding SendFeedback, Mode=OneTime}"
                    Style="{StaticResource StatusBarButton}"
                    ToolTip="{x:Static properties:Resources.SendFeedback}">
                    <md:PackIcon Kind="CommentAlert" />
                </Button>
            </VirtualizingStackPanel>
        </Grid>

        <!--#endregion-->

        <!--#region PropertyControl-->
        <md:Card
            Grid.Row="1"
            Grid.RowSpan="3"
            Margin="10,5,5,10"
            Padding="0,0,0,0"
            HorizontalContentAlignment="Stretch"
            VerticalContentAlignment="Stretch"
            Background="{DynamicResource MaterialDesignCardBackground}"
            Content="{Binding Project.PreviewScene, Converter={StaticResource SceneToPropertyTab}, Source={x:Static model:AppData.Current}, Mode=OneWay}"
            IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
            IsHitTestVisible="{Binding Source={x:Static model:AppData.Current}, Path=IsNotPlaying, Mode=OneWay}"
            UniformCornerRadius="0" />

        <!--#endregion-->

        <GridSplitter
            Grid.Row="1"
            Grid.RowSpan="3"
            Grid.Column="1"
            Width="10"
            HorizontalAlignment="Stretch"
            Background="Transparent"
            Foreground="Transparent" />

        <tool:PannelControl
            Grid.Row="1"
            Grid.Column="2"
            Margin="0,5,5,5"
            IsHitTestVisible="{Binding Source={x:Static model:AppData.Current}, Path=IsNotPlaying, Mode=OneWay}" />

        <GridSplitter
            Grid.Row="1"
            Grid.Column="3"
            Width="10"
            HorizontalAlignment="Stretch"
            Background="Transparent"
            Foreground="Transparent" />

        <Grid Grid.Row="1" Grid.Column="4">
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="35" />
            </Grid.RowDefinitions>
            <Image
                Margin="0"
                IsHitTestVisible="False"
                Source="{Binding PreviewImage.Value, Mode=OneWay}" />

            <custom:Seekbar
                Grid.Row="1"
                Height="35"
                VerticalAlignment="Bottom"
                End="{Binding FrameEnd, Mode=OneTime}"
                EndToolTip="{x:Static properties:Resources.MoveToEnd}"
                Foreground="{Binding MainWindowColor.Value, Mode=OneWay}"
                IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                Maximum="{Binding Source={x:Static model:AppData.Current}, Path=Project.PreviewScene.TotalFrame, Mode=OneWay, Converter={StaticResource FrameConverter}}"
                Next="{Binding FrameNext, Mode=OneTime}"
                NextToolTip="{x:Static properties:Resources.MoveToNextFrame}"
                PlayPause="{Binding PlayPause, Mode=OneTime}"
                PlayPauseIcon="{Binding AppStatus, Source={x:Static model:AppData.Current}, Converter={StaticResource AppStatusToPlayerIcon}, Mode=OneWay}"
                PlayPauseToolTip="{x:Static properties:Resources.PlayPause}"
                Previous="{Binding FramePrevious, Mode=OneTime}"
                PreviousToolTip="{x:Static properties:Resources.MoveToPreviousFrame}"
                Top="{Binding FrameTop, Mode=OneTime}"
                TopToolTip="{x:Static properties:Resources.MoveToTop}"
                Value="{Binding Source={x:Static model:AppData.Current}, Path=Project.PreviewScene.PreviewFrame, Mode=TwoWay, Converter={StaticResource FrameConverter}}" />
        </Grid>

        <ContentControl
            x:Name="ToolTipControl"
            Grid.Row="1"
            Grid.ColumnSpan="5"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            HorizontalContentAlignment="Stretch"
            VerticalContentAlignment="Stretch"
            Content="{Binding ToolTipControl.Value, Mode=TwoWay}" />

        <GridSplitter
            Grid.Row="2"
            Grid.Column="2"
            Grid.ColumnSpan="3"
            Height="10"
            HorizontalAlignment="Stretch"
            Background="Transparent"
            Foreground="Transparent" />

        <!--#region タイムライン-->
        <md:Card
            Grid.Row="3"
            Grid.Column="1"
            Grid.ColumnSpan="4"
            Margin="5,0,10,10"
            IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
            IsHitTestVisible="{Binding Source={x:Static model:AppData.Current}, Path=IsNotPlaying, Mode=OneWay}"
            UniformCornerRadius="0">
            <Label
                Padding="0,0,0,0"
                HorizontalContentAlignment="Stretch"
                VerticalContentAlignment="Stretch"
                Content="{Binding Project.PreviewScene, Converter={StaticResource SceneToTimeLine}, Source={x:Static model:AppData.Current}, Mode=OneWay}" />
        </md:Card>
        <!--#endregion-->

        <md:Snackbar
            x:Name="Snackbar"
            Grid.RowSpan="4"
            Grid.ColumnSpan="5"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            MessageQueue="{Binding MessageQueue, Mode=OneWay}" />

        <StatusBar
            Grid.Row="4"
            Grid.ColumnSpan="5"
            Height="24"
            Background="{Binding MainWindowColor.Value}"
            IsHitTestVisible="{Binding Source={x:Static model:AppData.Current}, Path=IsNotPlaying, Mode=OneWay}">
            <StatusBarItem Padding="0">
                <VirtualizingStackPanel Orientation="Horizontal">
                    <Button Style="{StaticResource StatusBarButton}">
                        <VirtualizingStackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                            <md:PackIcon
                                Margin="5,0,5,0"
                                VerticalAlignment="Center"
                                Kind="{Binding AppStatus, Source={x:Static model:AppData.Current}, Converter={StaticResource AppStatusIcon}, Mode=OneWay}" />
                            <TextBlock
                                Margin="5,0,10,0"
                                VerticalAlignment="Center"
                                FontWeight="Normal"
                                Text="{Binding AppStatus, Source={x:Static model:AppData.Current}, Converter={StaticResource AppStatusText}, Mode=OneWay}" />
                        </VirtualizingStackPanel>
                    </Button>

                    <ProgressBar
                        Width="200"
                        VerticalAlignment="Center"
                        Background="{StaticResource SecondaryHueMidBrush}"
                        BorderThickness="0"
                        Foreground="{StaticResource SecondaryHueDarkBrush}"
                        IsIndeterminate="{Binding IsLoading.Value, Mode=OneWay, Converter={StaticResource NotConverter}}"
                        Visibility="{Binding IsLoading.Value, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </VirtualizingStackPanel>
            </StatusBarItem>
            <StatusBarItem Padding="0" HorizontalAlignment="Right">
                <VirtualizingStackPanel Orientation="Horizontal">
                    <TextBlock VerticalAlignment="Center" IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{} {0}/{1} Frame">
                                <Binding Path="Project.PreviewScene.PreviewFrame.Value" Source="{x:Static model:AppData.Current}" />
                                <Binding Path="Project.PreviewScene.TotalFrame.Value" Source="{x:Static model:AppData.Current}" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                    <Slider
                        Width="250"
                        Height="Auto"
                        Margin="10,0,10,0"
                        VerticalAlignment="Center"
                        BorderBrush="{StaticResource SecondaryHueMidBrush}"
                        Foreground="{StaticResource SecondaryHueMidBrush}"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        Maximum="200"
                        Minimum="1"
                        Visibility="{Binding ProjectIsOpened.Value, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Value="{Binding Source={x:Static model:AppData.Current}, Path=Project.PreviewScene.TimeLineZoom}" />
                    <Button
                        Padding="8,0,8,0"
                        Content="{Binding Source={x:Static model:AppData.Current}, Path=Project.Name, Converter={StaticResource ToFileNameConverter}}"
                        IsEnabled="{Binding ProjectIsOpened.Value, Mode=OneWay}"
                        Style="{StaticResource StatusBarOpenContextButton}">
                        <Button.ContextMenu>
                            <ContextMenu>
                                <MenuItem Command="{Binding OpenProjectDirectory, Mode=OneTime}" Header="{x:Static properties:Resources.OpenProjectDirectory}" />
                                <MenuItem Command="{Binding ConvertJson, Mode=OneTime}" Header="{x:Static properties:Resources.ConvertJson}" />
                            </ContextMenu>
                        </Button.ContextMenu>
                    </Button>
                </VirtualizingStackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Controls:MetroWindow>
