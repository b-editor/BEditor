<UserControl
    x:Class="BEditor.Views.TimeLines.ClipUI"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:convert="clr-namespace:BEditor.ViewModels.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:BEditor.Views.TimeLines"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:properties="clr-namespace:BEditor.Properties;assembly=BEditor.Core"
    xmlns:vm="clr-namespace:BEditor.ViewModels"
    Width="{Binding WidthProperty.Value, Mode=OneWay}"
    Margin="{Binding MarginProperty.Value, Mode=OneWay}"
    Cursor="{Binding ClipCursor.Value, Mode=TwoWay}"
    mc:Ignorable="d">
    <UserControl.Resources>
        <convert:EffectElementToKeyFrame x:Key="EffectElementToKeyFrame" />
        <Style x:Key="BorberStyle" TargetType="Border">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.85" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    <VirtualizingStackPanel
        Orientation="Vertical"
        VirtualizingPanel.IsVirtualizing="True"
        VirtualizingPanel.VirtualizationMode="Recycling">
        <ContentControl>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="MouseDoubleClick">
                    <i:InvokeCommandAction Command="{Binding ClipMouseDoubleClickCommand, Mode=OneTime}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <Border Background="{Binding ClipColor.Value}" Style="{StaticResource BorberStyle}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseLeftButtonDown">
                        <i:InvokeCommandAction Command="{Binding ClipMouseLeftDownCommand, Mode=OneTime}" />
                    </i:EventTrigger>
                    <i:EventTrigger EventName="MouseLeftButtonUp">
                        <i:InvokeCommandAction Command="{Binding ClipMouseUpCommand, Mode=OneTime}" />
                    </i:EventTrigger>
                    <i:EventTrigger EventName="MouseMove">
                        <i:InvokeCommandAction
                            Command="{Binding ClipMouseMoveCommand, Mode=OneTime}"
                            EventArgsConverter="{x:Static vm:MousePositionConverter.Converter}"
                            EventArgsConverterParameter="{Binding RelativeSource={RelativeSource AncestorType=Border}}"
                            PassEventArgsToCommand="True" />
                    </i:EventTrigger>
                    <i:EventTrigger EventName="MouseRightButtonDown">
                        <i:InvokeCommandAction
                            Command="{Binding ClipMouseRightDownCommand, Mode=OneTime}"
                            EventArgsConverter="{x:Static vm:MousePositionConverter.Converter}"
                            EventArgsConverterParameter="{Binding RelativeSource={RelativeSource AncestorType=Border}}"
                            PassEventArgsToCommand="True" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
                <Border.ContextMenu>
                    <ContextMenu>
                        <MenuItem Command="{Binding ClipDataLogCommand, Mode=OneTime}">
                            <MenuItem.Header>
                                <VirtualizingStackPanel Orientation="Horizontal">
                                    <md:PackIcon Margin="5,0,5,0" Kind="InformationOutline" />
                                    <TextBlock Margin="20,0,5,0" Text="{x:Static properties:Resources.ClipInfo}" />
                                </VirtualizingStackPanel>
                            </MenuItem.Header>
                        </MenuItem>
                        <Separator />
                        <MenuItem Command="{Binding ClipSeparateCommand, Mode=OneTime}">
                            <MenuItem.Header>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <VirtualizingStackPanel Orientation="Horizontal">
                                        <md:PackIcon Margin="5,0,5,0" Kind="PaperCutVertical" />
                                        <TextBlock Margin="20,0,5,0" Text="{x:Static properties:Resources.Separate}" />
                                    </VirtualizingStackPanel>
                                    <TextBlock Grid.Column="1" Text="" />
                                </Grid>
                            </MenuItem.Header>
                        </MenuItem>
                        <Separator />
                        <MenuItem Command="{Binding ClipCutCommand, Mode=OneTime}">
                            <MenuItem.Header>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <VirtualizingStackPanel Orientation="Horizontal">
                                        <md:PackIcon Margin="5,0,5,0" Kind="ContentCut" />
                                        <TextBlock Margin="20,0,5,0" Text="{x:Static properties:Resources.Cut}" />
                                    </VirtualizingStackPanel>
                                    <TextBlock Grid.Column="1" Text="Ctrl+X" />
                                </Grid>
                            </MenuItem.Header>
                        </MenuItem>
                        <MenuItem Command="{Binding ClipCopyCommand, Mode=OneTime}">
                            <MenuItem.Header>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <VirtualizingStackPanel Orientation="Horizontal">
                                        <md:PackIcon Margin="5,0,5,0" Kind="ContentCopy" />
                                        <TextBlock Margin="20,0,5,0" Text="{x:Static properties:Resources.Copy}" />
                                    </VirtualizingStackPanel>
                                    <TextBlock Grid.Column="1" Text="Ctrl+C" />
                                </Grid>
                            </MenuItem.Header>
                        </MenuItem>
                        <MenuItem IsEnabled="False">
                            <MenuItem.Header>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <VirtualizingStackPanel Orientation="Horizontal">
                                        <md:PackIcon Margin="5,0,5,0" Kind="ContentPaste" />
                                        <TextBlock Margin="20,0,5,0" Text="{x:Static properties:Resources.Paste}" />
                                    </VirtualizingStackPanel>
                                    <TextBlock Grid.Column="1" Text="Ctrl+V" />
                                </Grid>
                            </MenuItem.Header>
                        </MenuItem>
                        <Separator />
                        <MenuItem Command="{Binding ClipDeleteCommand, Mode=OneTime}">
                            <MenuItem.Header>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <VirtualizingStackPanel Orientation="Horizontal">
                                        <md:PackIcon Margin="5,0,5,0" Kind="Delete" />
                                        <TextBlock Margin="20,0,5,0" Text="{x:Static properties:Resources.Remove}" />
                                    </VirtualizingStackPanel>
                                    <TextBlock Grid.Column="1" Text="Delete" />
                                </Grid>
                            </MenuItem.Header>
                        </MenuItem>
                    </ContextMenu>
                </Border.ContextMenu>
                <Grid Height="{Binding TrackHeight, Mode=OneTime}">
                    <VirtualizingStackPanel Orientation="Horizontal">
                        <TextBlock
                            Margin="10,0,10,0"
                            VerticalAlignment="Center"
                            FontSize="14"
                            Foreground="White"
                            Text="{Binding ClipText.Value, Mode=OneWay}" />
                        <TextBlock
                            Margin="10,0,10,0"
                            VerticalAlignment="Center"
                            FontSize="12"
                            Foreground="White"
                            Text="{Binding ClipElement.LabelText, Mode=OneWay}" />
                    </VirtualizingStackPanel>
                </Grid>
            </Border>

        </ContentControl>
        <ItemsControl
            x:Name="itemsControl"
            HorizontalContentAlignment="Stretch"
            VerticalContentAlignment="Stretch"
            AlternationCount="{Binding Items.Count, ElementName=itemsControl}"
            ItemsSource="{Binding ClipElement.Effect, Mode=OneWay}">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Label
                        Padding="0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        HorizontalContentAlignment="Stretch"
                        VerticalContentAlignment="Stretch"
                        Content="{Binding Converter={StaticResource EffectElementToKeyFrame}}" />
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </VirtualizingStackPanel>
</UserControl>
